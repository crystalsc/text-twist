<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <style>
    html,
body,
header,
.view {
    background: rgb(158, 152, 152);
    }
    .side {
      justify-content: center;
      margin: auto;
      width: 50%;
      border: 3px solid green;
      padding: 10px;
      margin-top:50px;
    }

    .hidden {
      display: none;
    }

    .square {
      height: 50px;
      width: 50px;
      margin: 10px;
      border-style: ridge;
      border-width: 5px;
      border-color: coral;
      justify-content: center;
      text-align: center;
    }

    .letter {
      height: 50px;
      width: 50px;
      margin: 10px;
    }

    #game {
      display: none;
    }

    .buttons {
      margin: 10px;
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js"></script>

</head>

<body>
  <div class="side card shadow-lg p-3 mb-5 bg-white rounded" id="start">
      <div class="row buttons card-body">
          <button id="easy">Easy</button>
          <button id="med">Medium</button>
          <button id="hard">Hard</button>
        </div>
  </div>
  <div class="side card shadow-lg p-3 mb-5 bg-white rounded" id="game">
    <div class="card-body">
    <h1>Text Twist</h1>

    <div id="score">

    </div>
    <div id="mode">

    </div>
    <div class="row" id="boxes">

    </div>
    <div class="row" id="letters">

    </div>
    <div class="row buttons">
      <button onclick="checkSolution()">Enter</button>
    </div>
    <div id="response">

    </div>
  </div>
  </div>
</body>
<script>

  let letterCounter = 0;
  let dict = {};
  let dictSquare = {};
  let solution = [];
  let words = [];
  let score = 0;
  let weight = 0;
  let mode = "easy";
  let scoreMultiple = 1;

  function checkSolution() {
    $("#response").html("");
    $("#score").html("");
    if (words.includes(solution.join(''))) {
      $("#response").append(`Correct!`);
      score = parseInt(score) + (parseInt(weight)*scoreMultiple);
      $("#score").append("Score: " + score);
      $.ajax({
        method: "GET",
        url: "api.php",
        success: data => { showRacks(data) }
      });
    } else {
      $("#response").append(`Try Again!`);
    }
  }

  function clickLetter(index) {
    $("#letter-" + index).html('');
    document.getElementById("square-" + letterCounter).append(dict[index]);
    dictSquare[letterCounter] = index;
    letterCounter++;
    solution.push(dict[index]);
  }

  function clickSquare(index) {
    if (index == letterCounter - 1) {
      letterCounter--;
      document.getElementById("letter-" + dictSquare[letterCounter]).append(dict[dictSquare[letterCounter]]);
      $("#square-" + index).html('');
      solution.pop();
    }
  }

  let showRacks = function (racks) {
    letterCounter = 0;
    dict = {};
    dictSquare = {};
    solution = [];
    words = [];
    weight = 0;
    $("#boxes").html('');
    $("#letters").html('');
    racks.map(rack => {
      weight = rack.weight;
      words = rack.words.split('@@');
      console.log(words);
      rack.rack.split('').forEach(function (item, index) {
        dict[index] = item;
        $("#boxes").append(`<a class="square" onclick="clickSquare(${index})" id="square-${index}"></a>`);
        $("#letters").append(`<a class="letter" onclick="clickLetter(${index})" id="letter-${index}">${item}</a>`);
      });
    })

  }

  $(document).ready(function () {
    document.getElementById("game").style.display = "none";
    document.getElementById("start").style.display = "block";
    $("#easy").on("click", function() {
      mode = "Easy";
      scoreMultiple = 1;
      document.getElementById("game").style.display = "block";
      document.getElementById("start").style.display = "none";
      $.ajax({
        method: "GET",
        url: "api.php",
        data: { mode: "EASY"},
        success: data => { showRacks(data) }
      });
    });
    $("#med").on("click", function() {
      mode = "Medium";
      scoreMultiple = 2;
      document.getElementById("game").style.display = "block";
      document.getElementById("start").style.display = "none";
      $.ajax({
        method: "GET",
        url: "api.php",
        data: { mode: "MED"},
        success: data => { showRacks(data) }
      });
    });
    $("#hard").on("click", function() {
      scoreMultiple = 3;
      mode = "Hard";
      document.getElementById("game").style.display = "block";
      document.getElementById("start").style.display = "none";
      $.ajax({
        method: "GET",
        url: "api.php",
        data: { mode: "HARD"},
        success: data => { showRacks(data); }
      });
    });
    $("#score").append("Score: " + score);
    $("#mode").append("Mode: " + mode);
    $("#grabmore").on("click", function () {
      $.ajax({
        method: "GET",
        url: "api.php",
        success: data => { showRacks(data) }
      });
    });
  });
</script>

</html>