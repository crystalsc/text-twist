<!DOCTYPE html>
<html>

<head>
  <title>Text Twist</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="shortcut icon" href="faveicon.ico" />
  <style>
    html,
body,
header,
.view {
    background: rgb(233, 233, 233);
    }
    .side {
      width: 70%;
    }

    .hidden {
      display: none;
    }

    .square {
      height: 50px;
      width: 50px;
      margin: 10px;
      border-style: ridge;
      border-width: 5px;
      border-color: coral;
      justify-content: center;
      text-align: center;
    }

    .letter {
      height: 50px;
      width: 50px;
      margin: 10px;
      text-align: center;
    }

    #game, #compTimer {
      display: none;
    }

    .buttons {
      margin:10px;
    }
    a:hover {
  cursor: pointer;
  background:rgb(241, 238, 204);
}
.navbar {
  box-shadow: 0 2px 2px -2px rgba(0,0,0,.2);

    /* the rest of your styling */
}
  </style>

  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js"></script>

</head>

<body>
    <nav class="navbar navbar-dark bg-primary ">
        <div class="navbar-brand">Text Twist</div>
      </nav>
  <div class="container">
  <div class="d-flex justify-content-center">
  <div class="side card shadow p-3 mb-5 bg-white rounded" id="start">
        <div class="card-title">
            <h1>Let's Get Twisty! </h1>
            Select if you want to do competition mode and pick a difficulty setting to get started.
          </div>
          <div class="form-check">
              <input type="checkbox" class="form-check-input" id="competition">
              <label class="form-check-label" for="competition">Competition Mode</label>
            </div>
      <div class="row buttons card-body">
        
          <button class="btn btn-primary buttons" id="easy">Easy</button>
          <button class="btn btn-primary buttons" id="med">Medium</button>
          <button class="btn btn-primary buttons" id="hard">Hard</button>
        </div>
  </div>

  <div class="side card shadow p-3 mb-5 bg-white rounded" id="game">
      <div class="card-title">
          <h1>Let's Get Twisty! </h1>
        </div>
    <div class="card-body">
    <div id="score">

    </div>
    <div id="compTimer">
    Time Remaining: <span id="timer">05:00<span>
    </div>
    <div id="mode">

    </div>
    <div class="row" id="boxes">

    </div>
    <div class="row" id="letters">

    </div>
    <div class="row buttons">
      <button class="btn btn-primary" onclick="checkSolution()">Enter</button>
    </div>
    <div id="response">

    </div>
  </div>
  </div>
  </div>
</div>
</body>
<script>

  let letterCounter = 0;
  let dict = {};
  let dictSquare = {};
  let solution = [];
  let words = [];
  let score = 0;
  let weight = 0;
  let mode = "Easy";
  let scoreMultiple = 1;

  function checkSolution() {
    $("#response").html("");
    $("#score").html("");
    if (words.includes(solution.join(''))) {
      $("#response").append(`Correct!`);
      score = parseInt(score) + (parseInt(weight)*scoreMultiple);
      $("#score").append("Score: " + score);
      $.ajax({
        method: "GET",
        url: "api.php",
        data: { mode: mode},
        success: data => { showRacks(data) }
      });
    } else {
      $("#response").append(`Try Again!`);
    }
  }

  function clickLetter(index) {
    $("#letter-" + index).html('');
    document.getElementById("square-" + letterCounter).append(dict[index]);
    dictSquare[letterCounter] = index;
    letterCounter++;
    solution.push(dict[index]);
  }

  function clickSquare(index) {
    if (index == letterCounter - 1) {
      letterCounter--;
      document.getElementById("letter-" + dictSquare[letterCounter]).append(dict[dictSquare[letterCounter]]);
      $("#square-" + index).html('');
      solution.pop();
    }
  }

  let showRacks = function (racks) {
    console.log(racks);
    letterCounter = 0;
    dict = {};
    dictSquare = {};
    solution = [];
    words = [];
    weight = 0;
    $("#boxes").html('');
    $("#letters").html('');
    racks.map(rack => {
      weight = rack.weight;
      words = rack.words.split('@@');
      rack.rack.split('').forEach(function (item, index) {
        dict[index] = item;
        $("#boxes").append(`<a class="square" onclick="clickSquare(${index})" id="square-${index}"></a>`);
        $("#letters").append(`<a class="letter" onclick="clickLetter(${index})" id="letter-${index}">${item}</a>`);
      });
    })

  }

  $(document).ready(function () {
    document.getElementById("game").style.display = "none";
    document.getElementById("start").style.display = "block";
    let x = document.getElementById("competition").value;
    if (x === true) {
      document.getElementById("compTimer").style.display = "block";
      window.onload = function() {
      var hour = 2;
      var sec = 60;
      setInterval(function() {
        document.getElementById("timer").innerHTML = hour + " : " + sec;
        sec--;
        if (sec == 00) {
          hour--;
          sec = 60;
          if (hour == 0) {
            hour = 2;
          }
        }
      }, 1000);
    }
    }
    $("#easy").on("click", function() {
      mode = "Easy";
      document.getElementById("game").style.display = "block";
      document.getElementById("start").style.display = "none";
      $("#mode").append("Mode: " + mode);
      $.ajax({
        method: "GET",
        url: "api.php",
        data: { mode: "Easy"},
        success: data => { showRacks(data) }
      });
    });
    $("#med").on("click", function() {
      mode = "Medium";
      document.getElementById("game").style.display = "block";
      document.getElementById("start").style.display = "none";
      $("#mode").append("Mode: " + mode);
      $.ajax({
        method: "GET",
        url: "api.php",
        data: { mode: "Medium"},
        success: data => { showRacks(data) }
      });
    });
    $("#hard").on("click", function() {
      mode = "Hard";
      document.getElementById("game").style.display = "block";
      document.getElementById("start").style.display = "none";
      $("#mode").append("Mode: " + mode);
      $.ajax({
        method: "GET",
        url: "api.php",
        data: { mode: "Hard"},
        success: data => { showRacks(data); }
      });
    });
    $("#score").append("Score: " + score);
    $("#grabmore").on("click", function () {
      $.ajax({
        method: "GET",
        url: "api.php",
        success: data => { showRacks(data) }
      });
    });
  });
</script>

</html>